{"dependencies":[{"name":"properjs-router","loc":{"line":28,"column":26}},{"name":"properjs-controller","loc":{"line":29,"column":30}}],"generated":{"js":"/*!\n *\n * Asynchronous webpage transitioning with pushstate management.\n *\n * @PageController\n * @author: kitajchuk\n *\n * @module\n * - init\n * - isActive\n * - onload\n * - unload\n *\n *\n */\n(function ( factory ) {\n\n    if ( typeof exports === \"object\" && typeof module !== \"undefined\" ) {\n        module.exports = factory();\n\n    } else if ( typeof window !== \"undefined\" ) {\n        window.PageController = factory();\n    }\n\n})(function () {\n\n    // Useful stuff\n    var Router = require( \"properjs-router\" ),\n        Controller = require( \"properjs-controller\" ),\n\n        _router = null,\n        _config = [],\n        _modules = [],\n        _synced = {\n            active: [],\n            inactive: []\n        },\n        _initialized = false,\n        _timeBefore = null,\n        _timeDelay = 0,\n        _eventPrefix = \"page-controller-\",\n        _currentRoute = null,\n        _isFirstRoute = true,\n        _currentQuery = null,\n        _currentToString = null,\n        _isSamePage = false,\n        _silentMode = false,\n        _silentCallback = null,\n        _isRoutingActive = false,\n\n        // Singleton\n        _instance = null,\n\n\n    // Private functions\n    fire = function ( event, arg ) {\n        if ( !_silentMode ) {\n            _instance.fire( (_eventPrefix + event), arg );\n        }\n    },\n\n\n    isFunction = function ( fn ) {\n        return (typeof fn === \"function\");\n    },\n\n\n    isSameObject = function ( o1, o2 ) {\n        return (JSON.stringify( o1 ) === JSON.stringify( o2 ));\n    },\n\n\n    execInit = function ( method ) {\n        // One time module initialization\n        for ( var i = _modules.length; i--; ) {\n            if ( !_modules[ i ].__initialized && isFunction( _modules[ i ].init ) ) {\n                _modules[ i ].__initialized = true;\n                _modules[ i ].init();\n            }\n        }\n    },\n\n\n    execUnload = function () {\n        if ( _silentMode ) {\n            return;\n        }\n\n        // Unload currently active modules only\n        for ( var i = _synced.active.length; i--; ) {\n            if ( isFunction( _synced.active[ i ].unload ) ) {\n                _synced.active[ i ].unload();\n            }\n        }\n    },\n\n\n    execOnload = function () {\n        if ( _silentMode ) {\n            return;\n        }\n\n        // Unload newly active modules only\n        for ( var i = _synced.active.length; i--; ) {\n            if ( isFunction( _synced.active[ i ].onload ) ) {\n                _synced.active[ i ].onload();\n            }\n        }\n    },\n\n\n    getRouteDataToString = function ( data ) {\n        var ret = data.uri,\n            i;\n\n        for ( i in data.query ) {\n            ret += \"-\" + i + \"-\" + data.query[ i ];\n        }\n\n        for ( i in data.params ) {\n            ret += \"-\" + i + \"-\" + data.params[ i ];\n        }\n\n        return ret;\n    },\n\n\n    /**\n     * @fires page-controller-router-synced-modules\n     */\n    syncModules = function () {\n        if ( _silentMode ) {\n            return;\n        }\n\n        _synced.active = [];\n        _synced.inactive = [];\n\n        for ( var i = _modules.length; i--; ) {\n            var module = _modules[ i ];\n\n            if ( isFunction( module.isActive ) ) {\n                // isActive method should rebuild module variables\n                if ( module.isActive() ) {\n                    _synced.active.push( module );\n\n                } else {\n                    _synced.inactive.push( module );\n                }\n            }\n        }\n\n        fire( \"router-synced-modules\", _synced );\n    },\n\n\n    onRouterResponse = function ( data ) {\n        if ( _isRoutingActive ) {\n            return;\n        }\n\n        _isRoutingActive = true;\n\n        function __route() {\n            if ( (Date.now() - _timeBefore) >= _instance._options.transitionTime ) {\n                _instance.stop();\n\n                handleRouterResponse( data );\n            }\n        }\n\n        _instance.go( __route );\n    },\n\n\n    onPopGetRouter = function ( data ) {\n        if ( _isRoutingActive ) {\n            return;\n        }\n\n        onPreGetRouter( data.request );\n    \n        setTimeout( function () {\n            handleRouterResponse( data );\n\n        }, _instance._options.transitionTime );\n    },\n\n\n    /**\n     * @fires page-controller-router-transition-out\n     * @fires page-controller-router-samepage\n     */\n    onPreGetRouter = function ( data ) {\n        if ( _isRoutingActive ) {\n            return;\n        }\n\n        var isSameRequest = (_currentToString === getRouteDataToString( data ));\n\n        if ( isSameRequest ) {\n            fire( \"router-samepage\", {\n                request: data\n            });\n            _isSamePage = true;\n            return;\n        }\n\n        _timeBefore = Date.now();\n\n        if ( !_isFirstRoute ) {\n            fire( \"router-transition-out\", {\n                request: data\n            });\n        }\n    },\n\n\n    /**\n     * @fires page-controller-router-refresh-document\n     * @fires page-controller-router-transition-in\n     */\n    handleRouterResponse = function ( res ) {\n        if ( _isSamePage ) {\n            _isSamePage = false;\n            _isRoutingActive = false;\n            return;\n        }\n\n        var data = {\n            response: res.response.responseText,\n            request: res.request,\n            status: res.status\n        };\n\n        _currentRoute = data.request.uri;\n        _currentQuery = data.request.query;\n        _currentToString = getRouteDataToString( data.request );\n\n        // Think of this as window.onload, happens once\n        if ( _isFirstRoute ) {\n            _isFirstRoute = false;\n            _isRoutingActive = false;\n            syncModules();\n            execOnload();\n\n            fire( \"initialized-page\", data );\n\n        // All other Router sequences fall here\n        } else {\n            // Allow transition duration to take place\n            setTimeout(function () {\n                // 0.1 Sync modules and unload active ones\n                syncModules();\n                execUnload();\n\n                // 0.2 Refresh the document content\n                fire( \"router-refresh-document\", data );\n\n                // 0.3 Sync modules and onload newly active ones\n                syncModules();\n                execOnload();\n\n                // 0.4 Trigger transition of content to come back in\n                fire( \"router-transition-in\", data );\n\n                _isRoutingActive = false;\n\n                // 0.5 Check `silent` mode\n                if ( _silentMode ) {\n                    _silentMode = false;\n\n                    if ( isFunction( _silentCallback ) ) {\n                        _silentCallback( data );\n                        _silentCallback = null;\n                    }\n                }\n\n            }, _instance._options.transitionTime );\n        }\n    };\n\n\n    /**\n     *\n     * Page transition manager\n     * @constructor PageController\n     * @augments Controller\n     * @requires Controller\n     * @requires Router\n     * @memberof! <global>\n     * @param {object} options Settings for control features\n     * <ul>\n     * <li>transitionTime</li>\n     * <li>routerOptions</li>\n     * </ul>\n     *\n     */\n    var PageController = function ( options ) {\n        // Singleton\n        if ( !_instance ) {\n            _instance = this;\n\n            /**\n             *\n             * The default options\n             * @memberof _options\n             * @member _routerOptions\n             * @private\n             *\n             */\n            this._options = {\n                transitionTime: _timeDelay,\n                routerOptions: {\n                    pushStateOptions: {}\n                }\n            };\n\n            // Normalize usage options passed in\n            options = (options || {});\n\n            // Merge usage options with defaults\n            if ( options.transitionTime ) {\n                this._options.transitionTime = options.transitionTime;\n            }\n\n            if ( options.routerOptions ) {\n                for ( var i in options.routerOptions ) {\n                    this._options.routerOptions[ i ] = options.routerOptions[ i ];\n                }\n            }\n        }\n\n        return _instance;\n    };\n\n    PageController.prototype = new Controller();\n\n    /**\n     *\n     * Initialize controller on page\n     * @memberof PageController\n     * @method initPage\n     *\n     */\n    PageController.prototype.initPage = function () {\n        if ( _initialized ) {\n            return;\n        }\n\n        _initialized = true;\n\n        /**\n         *\n         * Instance of Router\n         * @private\n         *\n         */\n        _router = new Router( this._options.routerOptions );\n\n        if ( _router._matcher.parse( window.location.href, _config ).matched ) {\n            _router.bind();\n\n            for ( var i = _config.length; i--; ) {\n                _router.get( _config[ i ], onRouterResponse );\n            }\n\n            _router.on( \"preget\", onPreGetRouter );\n            _router.on( \"popget\", onPopGetRouter );\n\n            execInit();\n        }\n    };\n\n    /**\n     *\n     * Trigger the router on a uri and run PageController `silently`, so no events fire.\n     * @memberof PageController\n     * @method routeSilently\n     * @param {string} uri The route to trigger\n     * @param {function} cb The optional callback to fire when done\n     *\n     */\n    PageController.prototype.routeSilently = function ( uri, cb ) {\n        _silentMode = true;\n        _silentCallback = cb;\n        _router.trigger( uri );\n    };\n\n    /**\n     *\n     * Set the Router configuration\n     * @memberof PageController\n     * @method setConfig\n     * @param {object} config The config for MatchRoute\n     *\n     */\n    PageController.prototype.setConfig = function ( config ) {\n        _config = config;\n    };\n\n    /**\n     *\n     * Set the module configuration\n     * @memberof PageController\n     * @method setModules\n     * @param {object} modules The array of module objects\n     *\n     */\n    PageController.prototype.setModules = function ( modules ) {\n        if ( !modules ) {\n            return;\n        }\n\n        for ( var i = modules.length; i--; ) {\n            this.addModule( modules[ i ] );\n        }\n    };\n\n    /**\n     *\n     * Add to the module configuration\n     * @memberof PageController\n     * @method addModule\n     * @param {object} module The module object to add\n     *\n     */\n    PageController.prototype.addModule = function ( module ) {\n        if ( _modules.indexOf( module ) === -1 && isFunction( module.isActive ) && isFunction( module.onload ) && isFunction( module.unload ) ) {\n            _modules.push( module );\n\n        } else {\n            throw new Error( \"PageController ERROR - All registered modules require isActive, onload and unload methods.\" );\n        }\n    };\n\n    /**\n     *\n     * Returns the array of modules\n     * @memberof PageController\n     * @method getModules\n     * @returns array\n     *\n     */\n    PageController.prototype.getModules = function () {\n        return _modules;\n    };\n\n    /**\n     *\n     * Returns the MatchRoute config\n     * @memberof PageController\n     * @method getConfig\n     * @returns array\n     *\n     */\n    PageController.prototype.getConfig = function () {\n        return _config;\n    };\n\n    /**\n     *\n     * Returns the instances Router\n     * @memberof PageController\n     * @method getRouter\n     * @returns Router\n     *\n     */\n    PageController.prototype.getRouter = function () {\n        return _router;\n    };\n\n    /**\n     *\n     * Returns the instances PushState\n     * @memberof PageController\n     * @method getPusher\n     * @returns PushState\n     *\n     */\n    PageController.prototype.getPusher = function () {\n        return _router._pusher;\n    };\n\n    /**\n     *\n     * Returns the instances MatchRoute\n     * @memberof PageController\n     * @method getMatcher\n     * @returns MatchRoute\n     *\n     */\n    PageController.prototype.getMatcher = function () {\n        return _router._matcher;\n    };\n\n    /**\n     *\n     * Returns the current route pathed\n     * @memberof PageController\n     * @method getRoute\n     * @returns string\n     *\n     */\n    PageController.prototype.getRoute = function () {\n        return _currentRoute;\n    };\n\n    /**\n     *\n     * Returns the current query params object\n     * @memberof PageController\n     * @method getQuery\n     * @returns string\n     *\n     */\n    PageController.prototype.getQuery = function () {\n        return _currentQuery;\n    };\n\n    return PageController;\n\n});"},"hash":"16544be9eb6cc24bf8b109c705fa1d61"}